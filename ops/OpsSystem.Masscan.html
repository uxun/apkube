<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>Masscan - Uxun's WIKI</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Uxun's WIKI</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#ops">ops</a>
    &nbsp;&#187;&nbsp;Masscan
    <span class="updated">Page Updated&nbsp;
    2019-08-21 13:00
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <h1 id="port-scanning-masscan">Port scanning (masscan)</h1>
<p><a href="https://github.com/robertdavidgraham/masscan">Github</a><br />
<a href="https://centos.pkgs.org/7/nux-misc-x86_64/masscan-1.0.3-2.el7.nux.x86_64.rpm.html">YUM</a></p>
<h3 id="install-centos-7">Install (CentOS 7)</h3>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">git</span> <span class="n">gcc</span> <span class="n">make</span> <span class="n">libpcap</span><span class="o">-</span><span class="n">devel</span>
<span class="err">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/robertdavidgraham/masscan</span>
<span class="err">$</span> <span class="n">cd</span> <span class="n">masscan</span>
<span class="err">$</span> <span class="n">make</span>
<span class="err">$</span> <span class="n">cp</span> <span class="n">bin</span><span class="o">/</span><span class="n">masscan</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>
</pre></div>


<h3 id="use">Use</h3>
<p><strong>单端口，多端口，范围端口</strong></p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">masscan</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">p443</span>
<span class="err">$</span> <span class="n">masscan</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">p443</span><span class="p">,</span><span class="mi">80</span>
<span class="err">$</span> <span class="n">masscan</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">p22</span><span class="o">-</span><span class="mi">30</span>
</pre></div>


<p><strong>常用Top 100 个端口 ： -rate 100000 (每秒100000 个数据包)</strong></p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">masscan</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">--</span><span class="n">top</span><span class="o">-</span><span class="n">ports</span> <span class="mi">100</span>
<span class="err">$</span> <span class="n">masscan</span> <span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span><span class="n">p80</span> <span class="o">--</span><span class="n">banners</span> <span class="o">-</span><span class="n">oL</span> <span class="n">test</span><span class="p">.</span><span class="n">txt</span>
</pre></div>


<p><strong>结果保存格式</strong><br />
-oX filename：输出到filename的XML。<br />
-oG filename：输出到filename在的grepable格式。<br />
-oJ filename：输出到filename在JSON格<br />
-oL filename：输出到filename在txt</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="nx">masscan</span> <span class="mf">192.168.1.0</span><span class="p">/</span><span class="nx">24</span> <span class="na">-p443</span> <span class="na">-oX</span> <span class="nx">test1.xml</span>
<span class="o">&lt;?</span><span class="kt">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="cp">?&gt;</span>
<span class="c">&lt;!-- masscan v1.0 scan --&gt;</span>
<span class="nt">&lt;nmaprun</span> <span class="na">scanner=</span><span class="s">&quot;masscan&quot;</span> <span class="na">start=</span><span class="s">&quot;1546835805&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0-BETA&quot;</span>  <span class="na">xmloutputversion=</span><span class="s">&quot;1.03&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;scaninfo</span> <span class="na">type=</span><span class="s">&quot;syn&quot;</span> <span class="na">protocol=</span><span class="s">&quot;tcp&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;host</span> <span class="na">endtime=</span><span class="s">&quot;1546835805&quot;</span><span class="nt">&gt;&lt;address</span> <span class="na">addr=</span><span class="s">&quot;192.168.1.109&quot;</span> <span class="na">addrtype=</span><span class="s">&quot;ipv4&quot;</span><span class="nt">/&gt;&lt;ports&gt;&lt;port</span> <span class="na">protocol=</span><span class="s">&quot;tcp&quot;</span> <span class="na">portid=</span><span class="s">&quot;443&quot;</span><span class="nt">&gt;&lt;state</span> <span class="na">state=</span><span class="s">&quot;open&quot;</span> <span class="na">reason=</span><span class="s">&quot;syn-ack&quot;</span> <span class="na">reason_ttl=</span><span class="s">&quot;64&quot;</span><span class="nt">/&gt;&lt;/port&gt;&lt;/ports&gt;&lt;/host&gt;</span>

$ masscan 192.168.1.0/24 -p443 -oG test1
# Masscan 1.0.6 scan initiated Mon Jan  7 06:03:34 2019
# Ports scanned: TCP(1;443-443) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 192.168.1.245 ()  Ports: 443/open/tcp//https//
Host: 192.168.1.154 ()  Ports: 443/open/tcp//https//

$ masscan 192.168.1.0/24 -p443 -oJ test1
{   &quot;ip&quot;: &quot;192.168.1.156&quot;,   &quot;timestamp&quot;: &quot;1546841046&quot;, &quot;ports&quot;: <span class="cp">[</span> <span class="p">{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span> <span class="s2">&quot;proto&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;syn-ack&quot;</span><span class="p">,</span> <span class="s2">&quot;ttl&quot;</span><span class="p">:</span> <span class="mi">63</span><span class="p">}</span> <span class="cp">]</span> }

$ masscan  -p443 -oL tex.txt
#masscan
open tcp 443 192.168.1.246 1546842956
</pre></div>


<p><strong>文件配置类型</strong></p>
<p><code>masscan -p80,8000-8100 192.168.1.0/24 --echo &gt; 80.conf</code></p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cat</span> <span class="mf">80.</span><span class="n">conf</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">15137358560006438029</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mf">100.00</span>

<span class="cp"># TARGET SELECTION (IP, PORTS, EXCLUDES)</span>
<span class="n">ports</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span><span class="mi">8000</span><span class="o">-</span><span class="mi">8100</span>
<span class="n">range</span> <span class="o">=</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>


<p><code>masscan -c 80.conf --rate 1000</code></p>
<p><strong>配置文件事例</strong></p>
<p><code>$ masscan -c /path/filename</code></p>
<p>filename</p>
<div class="hlcode"><pre><span class="n">rate</span> <span class="o">=</span> <span class="mi">100000</span> 
<span class="n">output</span><span class="o">-</span><span class="n">format</span> <span class="o">=</span> <span class="n">xxx</span> 
<span class="n">output</span><span class="o">-</span><span class="n">status</span> <span class="o">=</span> <span class="n">all</span> 
<span class="n">output</span><span class="o">-</span><span class="n">filename</span> <span class="o">=</span> <span class="n">xxx</span><span class="p">.</span><span class="n">xxx</span> 
<span class="n">ports</span> <span class="o">=</span> <span class="mi">0</span><span class="o">-</span><span class="mi">65535</span> 
<span class="n">range</span> <span class="o">=</span> <span class="mf">0.0.0.0</span><span class="o">-</span><span class="mf">255.255.255.255</span> 
<span class="n">excludefile</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">.</span><span class="n">txt</span> 
<span class="n">excludeport</span><span class="o">=</span><span class="mi">443</span>
</pre></div>


<h5 id="_1">参数</h5>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>-p</td>
<td>指定端口进行扫描</td>
</tr>
<tr>
<td>--banners</td>
<td>获取banner信息,支持少量的协议</td>
</tr>
<tr>
<td>--rate</td>
<td>指定发包速率</td>
</tr>
<tr>
<td>-c,--conf</td>
<td>读取配置文件进行扫描</td>
</tr>
<tr>
<td>-e,--adapter</td>
<td>指定用来发包的网卡接口名称</td>
</tr>
<tr>
<td>--echo</td>
<td>将当前的配置重定向到一个配置文件中</td>
</tr>
<tr>
<td>--adapter-ip</td>
<td>指定发包的IP地址</td>
</tr>
<tr>
<td>--adapter-port</td>
<td>指定发包的源端口</td>
</tr>
<tr>
<td>--adapter-mac</td>
<td>指定发包的源MAC地址</td>
</tr>
<tr>
<td>--router-mac</td>
<td>指定网关的MAC地址</td>
</tr>
<tr>
<td>--exclude</td>
<td>IP地址范围黑名单,防止masscan扫描</td>
</tr>
<tr>
<td>--excludefile</td>
<td>指定IP地址范围黑名单文件</td>
</tr>
<tr>
<td>--includefile,-iL</td>
<td>读取一个范围列表进行扫描</td>
</tr>
<tr>
<td>--ping</td>
<td>扫描应该包含ICMP回应请求</td>
</tr>
<tr>
<td>--append-output</td>
<td>以附加的形式输出到文件</td>
</tr>
<tr>
<td>--iflist</td>
<td>列出可用的网络接口,然后退出</td>
</tr>
<tr>
<td>--retries</td>
<td>发送重试的次数,以1秒为间隔</td>
</tr>
<tr>
<td>-sL</td>
<td>不执行扫描,主要是生成一个随机地址列表</td>
</tr>
<tr>
<td>--readscan</td>
<td>读取从-oB生成的二进制文件,可以转化为XML或者JSON格式</td>
</tr>
<tr>
<td>--nmap</td>
<td>打印与nmap兼容的相关信息</td>
</tr>
<tr>
<td>--http-user-agent</td>
<td>设置user-agent字段的值</td>
</tr>
<tr>
<td>--show [open,close]</td>
<td>告诉要显示的端口状态,默认是显示开放端口</td>
</tr>
<tr>
<td>--pcap</td>
<td>将接收到的数据包以libpcap格式存储</td>
</tr>
<tr>
<td>--regress</td>
<td>运行回归测试,测试扫描器是否正常运行</td>
</tr>
<tr>
<td>--ttl</td>
<td>指定传出数据包的TTL值,默认为255</td>
</tr>
<tr>
<td>--wait</td>
<td>指定发送完包之后的等待时间,默认为10秒</td>
</tr>
<tr>
<td>--offline</td>
<td>没有实际的发包,主要用来测试开销</td>
</tr>
<tr>
<td>--connection-timeout</td>
<td>抓取banners时指定保持TCP连接的最大秒数,默认是30秒</td>
</tr>
</tbody>
</table>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2019 Uxun.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Page Updated 2019-09-17 21:39:17</p>
      </div> <!-- end footer-right -->
    </div>

    
    

  </body>
</html>