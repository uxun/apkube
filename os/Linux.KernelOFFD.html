<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>LinuxOF/FD - Uxun's WIKI</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Uxun's WIKI</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#../../../Dropbox/wiki/os">../../../Dropbox/wiki/os</a>
    &nbsp;&#187;&nbsp;LinuxOF/FD
    <span class="updated">Page Updated&nbsp;
    2019-08-21 13:00
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <h2 id="linux-increase-the-maximum-number-of-open-files-file-descriptors-fd">Linux Increase The Maximum Number Of Open Files / File Descriptors (FD)</h2>
<p><strong><a href="https://www.kernel.org/doc/Documentation/sysctl/fs.txt">NR_OPEN</a></strong></p>
<p>在linux kernel 2.6.25之前通过ulimit -n(setrlimit(RLIMIT_NOFILE))设置每个进程的最大打开文件句柄数不能超过NR_OPEN (1024*1024),也就是100多w(除非重新编译内核)，而在25之后，内核导出了一个sys接口可以修改这个最大值(/proc/sys/fs /nr_open).具体的changelog在<a href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=9cfe015aa424b3c003baba3841a60dd9b5ad319b">这里</a></p>
<p>NR_FILE</p>
<p>command</p>
<div class="hlcode"><pre><span class="na">-a</span><span class="err">：</span><span class="nx">显示目前资源限制的设定</span><span class="err">；</span>
<span class="na">-c</span> <span class="o">&lt;</span><span class="nx">core文件上限</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">设定core文件的最大值</span><span class="err">，</span><span class="nx">单位为区块</span><span class="err">；</span>
<span class="na">-d</span> <span class="o">&lt;</span><span class="nx">数据节区大小</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">程序数据节区的最大值</span><span class="err">，</span><span class="nx">单位为KB</span><span class="err">；</span>
<span class="na">-f</span> <span class="o">&lt;</span><span class="nx">文件大小</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">shell所能建立的最大文件</span><span class="err">，</span><span class="nx">单位为区块</span><span class="err">；</span>
<span class="na">-H</span><span class="err">：</span><span class="nx">设定资源的硬性限制</span><span class="err">，</span><span class="nx">也就是管理员所设下的限制</span><span class="err">；</span>
<span class="na">-m</span> <span class="o">&lt;</span><span class="nx">内存大小</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">指定可使用内存的上限</span><span class="err">，</span><span class="nx">单位为KB</span><span class="err">；</span>
<span class="na">-n</span> <span class="o">&lt;</span><span class="nx">文件数目</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">指定同一时间最多可开启的文件数</span><span class="err">；</span>
<span class="na">-p</span> <span class="o">&lt;</span><span class="nx">缓冲区大小</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">指定管道缓冲区的大小</span><span class="err">，</span><span class="nx">单位512字节</span><span class="err">；</span>
<span class="na">-s</span> <span class="o">&lt;</span><span class="nx">堆叠大小</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">指定堆叠的上限</span><span class="err">，</span><span class="nx">单位为KB</span><span class="err">；</span>
<span class="na">-S</span><span class="err">：</span><span class="nx">设定资源的弹性限制</span><span class="err">；</span>
<span class="na">-t</span> <span class="o">&lt;</span><span class="nx">CPU时间</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">指定CPU使用时间的上限</span><span class="err">，</span><span class="nx">单位为秒</span><span class="err">；</span>
<span class="na">-u</span> <span class="o">&lt;</span><span class="nx">程序数目</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">用户最多可开启的程序数目</span><span class="err">；</span>
<span class="na">-v</span> <span class="o">&lt;</span><span class="nx">虚拟内存大小</span><span class="o">&gt;</span><span class="err">：</span><span class="nx">指定可使用的虚拟内存上限</span><span class="err">，</span><span class="nx">单位为KB</span><span class="err">。</span>
</pre></div>


<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">ulimit</span> <span class="o">-</span><span class="n">a</span>
<span class="n">core</span> <span class="n">file</span> <span class="n">size</span>          <span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="mi">0</span>           <span class="err">#</span><span class="n">core</span><span class="err">文件的最大值为</span><span class="mi">100</span> <span class="n">blocks</span><span class="err">。</span>
<span class="n">data</span> <span class="n">seg</span> <span class="n">size</span>           <span class="p">(</span><span class="n">kbytes</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span> <span class="n">unlimited</span>   <span class="err">#进程的数据段可以任意大。</span>
<span class="n">scheduling</span> <span class="n">priority</span>             <span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">)</span> <span class="mi">0</span>
<span class="n">file</span> <span class="n">size</span>               <span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="o">-</span><span class="n">f</span><span class="p">)</span> <span class="n">unlimited</span>   <span class="err">#文件可以任意大。</span>
<span class="n">pending</span> <span class="n">signals</span>                 <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="mi">98304</span>       <span class="err">#最多有</span><span class="mi">98304</span><span class="err">个待处理的信号。</span>
<span class="n">max</span> <span class="n">locked</span> <span class="n">memory</span>       <span class="p">(</span><span class="n">kbytes</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">)</span> <span class="mi">32</span>          <span class="err">#一个任务锁住的物理内存的最大值为</span><span class="mi">32</span><span class="n">KB</span><span class="err">。</span>
<span class="n">max</span> <span class="n">memory</span> <span class="n">size</span>         <span class="p">(</span><span class="n">kbytes</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="n">unlimited</span>   <span class="err">#一个任务的常驻物理内存的最大值。</span>
<span class="n">open</span> <span class="n">files</span>                      <span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="mi">1024</span>        <span class="err">#一个任务最多可以同时打开</span><span class="mi">1024</span><span class="err">的文件。</span>
<span class="n">pipe</span> <span class="n">size</span>            <span class="p">(</span><span class="mi">512</span> <span class="n">bytes</span><span class="p">,</span> <span class="o">-</span><span class="n">p</span><span class="p">)</span> <span class="mi">8</span>           <span class="err">#管道的最大空间为</span><span class="mi">4096</span><span class="err">字节。</span>
<span class="n">POSIX</span> <span class="n">message</span> <span class="n">queues</span>     <span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="mi">819200</span>      <span class="err">#</span><span class="n">POSIX</span><span class="err">的消息队列的最大值为</span><span class="mi">819200</span><span class="err">字节。</span>
<span class="n">real</span><span class="o">-</span><span class="n">time</span> <span class="n">priority</span>              <span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span> <span class="mi">0</span>
<span class="n">stack</span> <span class="n">size</span>              <span class="p">(</span><span class="n">kbytes</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">)</span> <span class="mi">10240</span>       <span class="err">#进程的栈的最大值为</span><span class="mi">10240</span><span class="err">字节。</span>
<span class="n">cpu</span> <span class="n">time</span>               <span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="n">unlimited</span>   <span class="err">#进程使用的</span><span class="n">CPU</span><span class="err">时间。</span>
<span class="n">max</span> <span class="n">user</span> <span class="n">processes</span>              <span class="p">(</span><span class="o">-</span><span class="n">u</span><span class="p">)</span> <span class="mi">98304</span>       <span class="err">#当前用户同时打开的进程（包括线程）的最大个数为</span><span class="mi">98304</span><span class="err">。</span>
<span class="n">virtual</span> <span class="n">memory</span>          <span class="p">(</span><span class="n">kbytes</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span> <span class="n">unlimited</span>   <span class="err">#没有限制进程的最大地址空间。</span>
<span class="n">file</span> <span class="n">locks</span>                      <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="n">unlimited</span>   <span class="err">#所能锁住的文件的最大个数没有限制。</span>
</pre></div>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2019 Uxun.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Page Updated 2019-08-28 21:20:06</p>
      </div> <!-- end footer-right -->
    </div>

    
    

  </body>
</html>