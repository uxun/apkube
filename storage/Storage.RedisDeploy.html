<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>RedisDeploy - Uxun's WIKI</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Uxun's WIKI</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#../../../Dropbox/wiki/storage">../../../Dropbox/wiki/storage</a>
    &nbsp;&#187;&nbsp;RedisDeploy
    <span class="updated">Page Updated&nbsp;
    2019-08-21 13:00
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <h2 id="redis-deploy">Redis deploy</h2>
<h3 id="1repo">1.REPO</h3>
<div class="hlcode"><pre><span class="n">yum</span> <span class="n">install</span> <span class="n">epel</span><span class="o">-</span><span class="n">release</span> <span class="n">yum</span><span class="o">-</span><span class="n">utilssudo</span> 
<span class="n">yum</span> <span class="n">install</span> <span class="n">http</span><span class="o">:</span><span class="c1">//rpms.remirepo.net/enterprise/remi-release-7.rpmsudo </span>
<span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">enable</span> <span class="n">remi</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">redis</span>

<span class="cp"># start </span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">redis</span> <span class="o">&amp;&amp;</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">redis</span>
</pre></div>


<p><strong>Firewalld</strong></p>
<blockquote>
<p>如何使用防火墙注意配置</p>
</blockquote>
<div class="hlcode"><pre><span class="cp"># 配置</span>
<span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="p">.</span><span class="n">conf</span>
<span class="n">bind</span> <span class="mf">127.0.0.1</span> <span class="mf">192.168.1.121</span>

<span class="cp"># firewalld config</span>
<span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">new</span><span class="o">-</span><span class="n">zone</span><span class="o">=</span><span class="n">redis</span> <span class="o">--</span><span class="n">permanentsudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">redis</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanentsudo</span> 
<span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">redis</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">source</span><span class="o">=</span><span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">--</span><span class="n">permanentsudo</span> 
<span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">reload</span>
</pre></div>


<h3 id="2source">2.SOURCE</h3>
<blockquote>
<p>编译安装redis-3.2.5</p>
</blockquote>
<div class="hlcode"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span>
<span class="n">wget</span> <span class="n">http</span><span class="o">:</span><span class="c1">//download.redis.io/releases/redis-3.2.5.tar.gz</span>
<span class="n">tar</span> <span class="n">zxvf</span> <span class="n">redis</span><span class="o">-</span><span class="mf">3.2.5</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span> 
<span class="n">cd</span> <span class="n">redis</span><span class="o">-</span><span class="mf">3.2.5</span>
<span class="n">make</span>
<span class="n">make</span> <span class="n">test</span>
<span class="n">make</span> <span class="n">install</span> 
<span class="n">cd</span> <span class="n">utils</span>
<span class="n">sh</span> <span class="n">install_server</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p><strong>配置</strong></p>
<div class="hlcode"><pre><span class="cp"># sh install_server.sh</span>
<span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">service</span> <span class="n">installer</span>
<span class="n">This</span> <span class="n">script</span> <span class="n">will</span> <span class="n">help</span> <span class="n">you</span> <span class="n">easily</span> <span class="n">set</span> <span class="n">up</span> <span class="n">a</span> <span class="n">running</span> <span class="n">redis</span> <span class="n">server</span>

<span class="n">Please</span> <span class="n">select</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">port</span> <span class="k">for</span> <span class="n">this</span> <span class="n">instance</span><span class="o">:</span> <span class="p">[</span><span class="mi">6379</span><span class="p">]</span> <span class="mi">6380</span>
<span class="n">Please</span> <span class="n">select</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">config</span> <span class="n">file</span> <span class="n">name</span> <span class="p">[</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mf">6380.</span><span class="n">conf</span><span class="p">]</span>
<span class="n">Selected</span> <span class="k">default</span> <span class="o">-</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mf">6380.</span><span class="n">conf</span>
<span class="n">Please</span> <span class="n">select</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">log</span> <span class="n">file</span> <span class="n">name</span> <span class="p">[</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">redis_6380</span><span class="p">.</span><span class="n">log</span><span class="p">]</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="n">redis_6380</span><span class="p">.</span><span class="n">log</span>
<span class="n">Please</span> <span class="n">select</span> <span class="n">the</span> <span class="n">data</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">this</span> <span class="n">instance</span> <span class="p">[</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mi">6380</span><span class="p">]</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mi">6380</span>
<span class="n">Please</span> <span class="n">select</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">executable</span> <span class="n">path</span> <span class="p">[</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span><span class="p">]</span>
<span class="n">Selected</span> <span class="n">config</span><span class="o">:</span>
<span class="n">Port</span>           <span class="o">:</span> <span class="mi">6380</span>
<span class="n">Config</span> <span class="n">file</span>    <span class="o">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mf">6380.</span><span class="n">conf</span>
<span class="n">Log</span> <span class="n">file</span>       <span class="o">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="n">redis_6380</span><span class="p">.</span><span class="n">log</span>
<span class="n">Data</span> <span class="n">dir</span>       <span class="o">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mi">6380</span>
<span class="n">Executable</span>     <span class="o">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span>
<span class="n">Cli</span> <span class="n">Executable</span> <span class="o">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span>
<span class="n">Is</span> <span class="n">this</span> <span class="n">ok</span><span class="o">?</span> <span class="n">Then</span> <span class="n">press</span> <span class="n">ENTER</span> <span class="n">to</span> <span class="n">go</span> <span class="n">on</span> <span class="n">or</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">C</span> <span class="n">to</span> <span class="n">abort</span><span class="p">.</span>
<span class="n">Copied</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="mf">6380.</span><span class="n">conf</span> <span class="o">=&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">redis_6380</span>
<span class="n">Installing</span> <span class="n">service</span><span class="p">...</span>
<span class="n">Successfully</span> <span class="n">added</span> <span class="n">to</span> <span class="n">chkconfig</span><span class="o">!</span>
<span class="n">Successfully</span> <span class="n">added</span> <span class="n">to</span> <span class="n">runlevels</span> <span class="mi">345</span><span class="o">!</span>
<span class="n">Starting</span> <span class="n">Redis</span> <span class="n">server</span><span class="p">...</span>
<span class="n">Installation</span> <span class="n">successful</span><span class="o">!</span>
</pre></div>


<p><strong>install</strong></p>
<div class="hlcode"><pre><span class="cp"># modify /etc/redis/6380.conf</span>
<span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mf">6380.</span><span class="n">conf</span>
<span class="n">bind</span> <span class="mf">127.0.0.1</span>
<span class="n">dir</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="mi">6380</span>
<span class="cp"># add</span>
<span class="n">maxmemory</span> <span class="mi">2048</span><span class="n">m</span>
<span class="n">maxmemory</span><span class="o">-</span><span class="n">policy</span> <span class="n">allkeys</span><span class="o">-</span><span class="n">lru</span>

<span class="n">vim</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">vm</span><span class="p">.</span><span class="n">overcommit_memory</span><span class="o">=</span><span class="mi">1</span>
<span class="n">sysctl</span> <span class="n">vm</span><span class="p">.</span><span class="n">overcommit_memory</span><span class="o">=</span><span class="mi">1</span>

<span class="cp"># check</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">list</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">redis</span>

<span class="cp"># install </span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">redis_6380</span> <span class="n">start</span>
</pre></div>


<p>vim /etc/redis/6380.conf</p>
<div class="hlcode"><pre><span class="n">daemonize</span>       <span class="err">将</span><span class="n">Redis</span><span class="err">服务以守护进程在后台运行，则把该项的值改为</span><span class="n">yes</span>
<span class="n">pidfile</span>         <span class="err">可配置多个</span><span class="n">pid</span><span class="err">的</span><span class="p">,</span><span class="err">默认在</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="n">pid</span>
<span class="n">loglevel</span>        <span class="err">分为</span><span class="mi">4</span><span class="err">级，</span><span class="n">debug</span><span class="err">、</span><span class="n">verbose</span><span class="err">、</span><span class="n">notice</span><span class="err">、</span><span class="n">warning</span>
<span class="n">logfile</span>         <span class="n">logfile</span>
<span class="n">databases</span>       <span class="err">设置数据库的个数，默认使用的数据库为</span><span class="mi">0</span>
<span class="n">save</span>            <span class="err">设置</span><span class="n">redis</span><span class="err">进行数据库镜像的频率</span>
<span class="n">rdbcompression</span>  <span class="err">在进行镜像备份时，是否进行压缩</span>
<span class="n">dbfilename</span>      <span class="err">镜像备份文件的文件名</span>
<span class="n">dir</span>             <span class="err">数据库镜像备份文件的存放路径</span>
<span class="n">slaveof</span>         <span class="err">设置数据库为其他数据库的从数据库</span>
<span class="n">masterauth</span>      <span class="err">主数据库连接需要的密码验证</span>
<span class="n">requirepass</span>     <span class="err">设置登录时，需要使用的密码</span>
<span class="n">maxclients</span>      <span class="err">设置同时连接的最大客户端数量</span>
<span class="n">maxmemory</span>       <span class="err">设置</span><span class="n">redis</span><span class="err">能够使用的最大内存</span>
<span class="n">appendonly</span>      <span class="err">开启</span><span class="n">append</span> <span class="n">only</span><span class="err">模式</span>
<span class="n">appendfsync</span>     <span class="err">设置对</span><span class="n">appendonly</span><span class="p">.</span><span class="n">aof</span><span class="err">文件同步的频率</span>
<span class="n">activerehashing</span> <span class="err">重新</span><span class="n">hash</span>

<span class="n">vm</span><span class="o">-</span><span class="n">enabled</span>      <span class="err">是否开启虚拟内存支持</span>
<span class="n">vm</span><span class="o">-</span><span class="n">swap</span><span class="o">-</span><span class="n">file</span>    <span class="err">设置虚拟内存的交换文件路径</span>
<span class="n">vm</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">memory</span>   <span class="err">设置</span><span class="n">redis</span><span class="err">能够使用的最大虚拟内存</span>
<span class="n">vm</span><span class="o">-</span><span class="n">page</span><span class="o">-</span><span class="n">size</span>    <span class="err">设置虚拟内存的页大小</span>
<span class="n">vm</span><span class="o">-</span><span class="n">pages</span>        <span class="err">设置交换文件的总的</span><span class="n">page</span><span class="err">数量</span>
<span class="n">vm</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">threads</span>  <span class="err">设置</span><span class="n">VMIO</span><span class="err">同时使用的线程数量</span>
<span class="n">glueoutputbuf</span>   <span class="err">把小的输出缓存存放在一起</span>
<span class="n">hash</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">zipmap</span><span class="o">-</span><span class="n">entries</span> <span class="err">设置</span><span class="n">hash</span><span class="err">的临界值</span>
</pre></div>


<p>REFERNECE</p>
<p>https://juejin.im/post/5b7d226a6fb9a01a1e01ff64</p>
<p>https://juejin.im/post/5b8fc5536fb9a05d2d01fb11#heading-30</p>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2019 Uxun.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Page Updated 2019-09-13 17:35:04</p>
      </div> <!-- end footer-right -->
    </div>

    
    

  </body>
</html>